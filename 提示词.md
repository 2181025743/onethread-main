---
alwaysApply: true
---

---

## alwaysApply: true

## 工作规则

### 1. 项目文档资源利用

- 项目中包含大量 Markdown (.md) 和 PDF (.pdf) 文件
- 开发过程中应主动读取这些文档以获取项目信息、规范和指导
- 对于 PDF 文件，使用 MCP 工具进行读取和解析
- 这些文档可能包含:
  - 项目架构说明
  - 开发规范和标准
  - API 接口文档
  - 业务需求说明
  - 技术方案设计
- 在回答问题或进行开发时，优先参考这些文档中的信息

### 2. 语言要求

- 始终使用中文与用户交流
- 所有回复、解释和注释都应使用中文

### 3. 开发工具定位

- 用户使用 IntelliJ IDEA 中文版和 cursor 中文版 作为主要开发工具，两个软件设置和界面都为全中文

### 4. 进程管理规则

#### 4.1 终端进程管理

- 你可以随意调试以及重新启动运行项目，但调试运行完成后,你打开的所有终端进程必须关闭
- 避免留下占用系统资源或端口的僵尸进程

#### 4.2 模块进程端口关闭判断规则 **这不是可选项,而是强制要求**

- **需要关闭的情况:**
  - 你新打开的项目模块进程端口必须在对话结束前关闭
  - 你在代码修改后重启的进程端口也必须在测试完成后关闭
  - 你修改了该模块的代码并且该模块是运行状态
- **不需要关闭的情况:**
  - 已经在运行且对应代码未被修改的进程

#### 4.3 代码修改后的进程管理工作流程

1. 检查修改代码对应的服务是否正在运行
2. 如果服务正在运行,先停止它
3. 重启服务以测试和验证修改效果
4. 测试完成后,必须停止服务以释放端口,

- 对话结束时,所有你启动的进程必须全部关闭,无一例外 **这不是可选项,而是强制要求**

5. 确保修改后的代码能够正常启动,避免端口冲突问题

**核心原则:** 保持端口清洁,确保用户在 IDEA 中启动服务时不会遇到端口占用问题

### 5. 文档生成标准

- 默认不生成 Markdown 文档文件
- 如果生成了 Markdown 文件，文件名后缀必须跟上月日时分秒（格式：文件名\_MMddHHmmss.md）
- 已生成的 markdown 文件不要删除
- 仅在用户明确请求时创建文档
- 优先在对话中直接提供信息

### 6. 上下文信息利用

- 项目根目录下的多个 .txt 文件包含用户基本信息(如云服务器信息、MySQL 信息、Docker、Redis、Nacos 账号密码信息等)
- 需要时主动读取这些文件以获取上下文
- 使用这些信息提供更个性化和准确的帮助
- 主要参考文件:
  - `user.md`: 云服务器、MySQL、Redis、Nacos 等完整环境信息
  - `mysql.txt`: 数据库表结构及相关信息

### 7. Nacos 配置管理规则

- **版本信息**: 用户使用的是 Nacos 3.x 版本
- **账号密码信息**: 所有服务器、数据库的账号密码信息都在 `user.md` 文件中
- **获取最新配置**: 需要时可以通过以下方式获取 Nacos 配置信息:
  - **方式一**: 尽量多次尝试使用 Nacos 3.x Open API 通过 curl 命令直接查询配置
  - **方式二**: SSH 连接到服务器，使用 MySQL 命令查询 `nacos_config` 数据库
- **Nacos API 操作规范**:
  - **服务地址**: 参考 `user.md`文件
  - **认证信息**: 用户名 `nacos`，密码 `A1472580369Z`
  - **API 版本**: 使用 Nacos 3.x 版本的 API 接口规范
- **编码规范**:
  - **查询编码格式**: 在进行任何配置操作前，必须先查询数据库或表的编码格式，若前文已查询可忽略
  - **编码查询命令**:
    ```sql
    -- 查询数据库编码
    SHOW CREATE DATABASE nacos_config;
    -- 查询表编码
    SHOW CREATE TABLE config_info;
    ```
  - **选择正确编码**: 根据查询结果选择与数据库一致的编码格式（通常为 utf8mb4）
  - **注意编码问题**: 所有 Nacos 配置操作必须使用与数据库一致的编码格式
  - 在通过 API 或数据库操作配置时，确保字符编码设置正确，避免中文乱码问题
- **配置格式规范**:
  - **配置文件格式**: Nacos 配置文件默认使用 YAML 格式
  - **命名空间操作**:
    - **强制要求**: 所有配置的增删改查操作**必须**在正确的命名空间（namespace）下进行
    - **操作前检查**: 在执行任何 Nacos 配置操作前，**必须先确认**目标命名空间 ID
    - **参数指定**: 使用 API 或数据库操作时，**务必明确指定** namespace 参数
    - **严禁操作**: 严禁在未确认命名空间的情况下进行配置操作，避免操作到错误的配置环境
  - 在使用 API 或数据库操作时，务必指定正确的 namespace 参数，避免操作到错误的配置环境
- **配置新增或更新标准流程** (**强制要求**):
  1. **查询数据库编码**: 先查询目标数据库和表的编码格式
  2. **生成临时 YAML 文件**: 在本地创建临时的 YAML 配置文件，使用与数据库一致的编码格式保存
  3. **使用 curl 上传配置**: 通过 Nacos 3.x Open API 使用 curl 命令上传配置文件
  4. **删除临时文件**: 验证通过后，删除本地临时 YAML 文件
  - **验证要求**: 每次配置上传后，**必须**通过 API 查询验证配置内容是否与预期一致，特别检查中文字符是否正常显示，确认无误后才能删除临时文件
- **操作建议**:
  - **优先使用 curl 命令通过 Nacos 3.x Open API** 进行配置的读取、查询和增删改操作
  - 需要批量操作或复杂查询时，可通过 SSH 连接服务器直接查询 MySQL 数据库
  - 本地 `nacos/` 文件夹仅作为配置结构参考
  - 注意 Nacos 3.x 版本与 2.x 版本在 API 接口和功能上可能存在差异，操作有需要时参考 3.x 版本文档

### 8. SQL 语句执行规则

- **执行方式**: 遇到需要执行 SQL 语句的情况，必须按照以下标准流程操作：
  1. **查询数据库编码**: 先查询目标数据库和表的编码格式，若前文已查询可忽略
     ```sql
     -- 查询数据库编码
     SHOW CREATE DATABASE database_name;
     -- 查询表编码
     SHOW CREATE TABLE table_name;
     ```
  2. **在本地创建 SQL 文件**: 在本地创建 SQL 文件，使用与数据库一致的编码格式保存（通常为 UTF-8/utf8mb4）
  3. **上传到服务器**: 使用 SCP 或其他工具将 SQL 文件上传到服务器
  4. **在服务器执行**: 在服务器上使用命令执行 SQL 文件
  5. **清理临时文件**: 执行完成后，删除本地和服务器上的 SQL 文件
- **编码规范**:
  - **强制要求**: 如果 SQL 语句中包含中文字符，**必须**在本地生成 SQL 文件并上传到服务器执行
  - **严禁操作**: 严禁使用 `ssh + docker exec + 管道` 方式直接传输包含中文字符的 SQL 内容，防止字符编码问题导致中文乱码
  - **例外情况**: 如果 SQL 语句不包含中文字符（纯英文、数字、符号），可以使用管道方式直接执行
- **验证要求**:
  - 执行 SQL 后必须验证数据是否正确写入
  - 检查中文字符是否正常显示，确保编码格式正确
  - 确认无误后再删除本地和服务器临时 SQL 文件
- **文件命名**: SQL 文件建议使用有意义的名称，如 `insert_goods_data_MMddHHmmss.sql`

### 9. 文件读取工具规则

- 优先使用系统工具读取文件
- **关键规则**: 如果你需要的文件系统工具无法读取或者你觉得没有读取完全,**必须立即**使用 MCP 文件系统工具(mcp_filesystem)尝试读取,**这不是可选项,而是强制要求**
- **重要警告！！！**: 某些特殊文件(例如前端的 .env 文件、隐藏配置文件等)系统工具**无法读取**,对于这类文件**必须直接使用** MCP 文件系统工具(mcp_filesystem)进行读取,**不要尝试系统工具**
- **验证要求**: 在确认"文件不存在"或"无法读取"之前,**必须同时尝试**系统工具和 MCP 文件系统工具(mcp_filesystem)两种方式,**只有两种方式都失败后**才能得出文件确实不存在的结论
- **执行检查清单**:
  1. ✓ 首先使用系统工具尝试读取
  2. ✓ 如果失败或不完整,**立即**使用 MCP 文件系统工具(mcp_filesystem)
  3. ✓ 对于 .env、.config 等隐藏文件,**直接**使用 MCP 文件系统工具(mcp_filesystem)
  4. ✓ 两种方式都尝试后才能确认文件状态

### 10. 图片识别规则

- **识别困难说明**: 当用户的消息中包含图片时，若图片内容因模糊、字迹过小或其他原因导致无法准确识别，**必须**在回复中明确说明无法识别的具体原因
- **说明方式示例**:
  - "图片内容模糊，无法正确识别文字"
  - "图片中文字过小，无法辨认"
  - "图片像素过高，无法清晰识别内容"
  - "图片分辨率过低，无法准确读取信息"
- **禁止行为**: 严禁在无法准确识别图片内容的情况下进行未经确认的推测或假设性描述
- **客观原则**: 确保回复中客观说明识别困难的情况，不进行主观臆断

### 11. Nacos 配置管理规则

- **版本识别**: 项目使用 Nacos 3.x 版本，API 接口与 Nacos 2.x 存在重大差异
- **API 路径规范**:
  - **禁止使用**: `/nacos/v2/cs/config`（已废弃，返回 HTTP 410）
  - **必须使用**: `/nacos/v3/admin/cs/config`（新的 admin API）
  - **接口分类**:
    - Client API（客户端SDK使用）: `/nacos/v2/*`
    - Admin API（控制台/管理使用）: `/nacos/v3/admin/*`
- **参数命名变化**:
  - 使用 `groupName` 替代 `group`
  - 使用 `namespaceId` 替代 `tenant`
- **配置管理操作**:
  - 列出配置: `GET /nacos/v3/admin/cs/config/list`
  - 获取配置: `GET /nacos/v3/admin/cs/config?dataId=xxx&groupName=yyy`
  - 发布配置: `POST /nacos/v3/admin/cs/config`
- **响应格式**: Nacos 3.x 统一使用标准响应格式
  ```json
  {
    "code": 0,
    "message": "success",
    "data": { ... }
  }
  ```
- **兼容性说明**: 如需使用旧版 v2 API，需在 `application.properties` 中启用兼容模式：
  ```properties
  nacos.core.api.compatibility.console.enabled=true
  ```
- **本地配置参考**: 本地 `nacos/` 文件夹仅作为配置结构参考，实际操作必须使用 Nacos 3.x API
- **操作要求**: 进行 Nacos 配置管理操作时，必须参考 Nacos 3.x 官方文档，确保使用正确的 API 路径和参数


### 12. 问题排查规则

- 在运行程序后,可以通过浏览器开发者工具进行操作及查看相关日志，你可以在代码中添加打印功能或打印日志功能便于你启动后排查
- 排查问题时,确认数据库的增删改查操作是否正常执行，本机已配置免密连接至两个服务器，可直接使用 SSH 登录服务器执行 SQL 命令进行验证。，数据库的账号密码信息都在 `user.md` 文件中
- 使用 MCP 浏览器开发者工具查看网络请求、控制台错误等
- 查看项目日志文件，若某个模块尚未启用日志功能，应及时添加日志记录逻辑，并在重新部署或重启模块后，通过浏览器或其它调试工具触发相关操作，以生成并分析日志信息
- **关键排查规则**: 如果经过多次排查（通常指 2-3 次尝试）仍未找到错误根源，**必须立即**在相关代码中添加完整详细的日志打印输出功能开始调试，**这不是可选项，而是强制要求**
  - 日志应包含：方法入口/出口、关键变量值、条件判断结果、异常堆栈信息等
  - 日志级别应合理使用（DEBUG/INFO/WARN/ERROR）
  - 确保日志输出到文件或控制台，便于追踪问题
- 结合前后端日志综合分析问题 -如果排查始终无法定位问题或者用户明显不耐烦你进行了多次的无用代码改正，请持续使用多种调试工具与策略（如断点调试、打印调试、边界条件测试等），进行深入分析，不限制使用的调试时间与 AI 响应长度（token）直至真正排查到原因，问题定位后，必须彻底回归测试，确认问题是否真正解决；若问题仍存在，继续深化排查，直至问题彻底解决。

以上规则每次对话都必须严格遵守， **这不是可选项,而是强制要求**


